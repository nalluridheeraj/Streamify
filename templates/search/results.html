{% extends 'base/base.html' %}
{% block title %}Search: {{ query }} - Streamify{% endblock %}
{% block content %}
<div class="mt-4">
    <h4 class="mb-3">
        {% if query %}Search results for "<strong>{{ query }}</strong>"{% else %}Browse All{% endif %}
        <small class="text-muted">({{ result_count }} results)</small>
    </h4>
    <!-- Filters -->
    <div class="d-flex flex-wrap gap-2 mb-4">
        <form class="d-flex gap-2 flex-wrap" action="{% url 'search:search' %}" method="GET">
            <input type="hidden" name="q" value="{{ query }}">
            <select name="type" class="form-select form-select-sm bg-dark text-white border-secondary" style="width:auto" onchange="this.form.submit()">
                <option value="">All Types</option>
                <option value="music" {% if content_type == 'music' %}selected{% endif %}>Music</option>
                <option value="video" {% if content_type == 'video' %}selected{% endif %}>Video</option>
                <option value="podcast" {% if content_type == 'podcast' %}selected{% endif %}>Podcast</option>
            </select>
            <select name="sort" class="form-select form-select-sm bg-dark text-white border-secondary" style="width:auto" onchange="this.form.submit()">
                <option value="relevance" {% if sort == 'relevance' %}selected{% endif %}>Most Popular</option>
                <option value="newest" {% if sort == 'newest' %}selected{% endif %}>Newest</option>
                <option value="oldest" {% if sort == 'oldest' %}selected{% endif %}>Oldest</option>
            </select>
        </form>
    </div>
    <div class="row g-3">
        {% for item in results %}
        <div class="col-6 col-md-4 col-lg-3">
            <div class="card bg-dark border-secondary h-100 content-card">
                <div class="position-relative">
                    {% if item.thumbnail %}<img src="{{ item.thumbnail.url }}" class="card-img-top" style="height:150px;object-fit:cover" alt="">
                    {% else %}<div class="card-img-top d-flex align-items-center justify-content-center bg-secondary" style="height:150px"><i class="bi bi-{% if item.content_type == 'music' %}music-note-beamed text-success{% elif item.content_type == 'video' %}camera-video text-primary{% else %}mic text-warning{% endif %}" style="font-size:3rem"></i></div>{% endif %}
                    {% if item.is_premium %}<span class="position-absolute top-0 start-0 m-1 badge bg-warning text-dark"><i class="bi bi-star-fill"></i></span>{% endif %}
                </div>
                <div class="card-body p-2">
                    <a href="{% url 'content:detail' item.pk %}" class="text-white text-decoration-none"><h6 class="mb-0 text-truncate">{{ item.title }}</h6></a>
                    <small class="text-muted">{{ item.artist_name|default:item.uploaded_by.name }}</small>
                    <div class="mt-1"><small class="text-muted"><i class="bi bi-eye"></i> {{ item.view_count }}</small></div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center py-5">
            <i class="bi bi-search text-muted" style="font-size:4rem"></i>
            <h5 class="text-muted mt-2">No results found</h5>
            <p class="text-muted">Try different keywords or browse all content.</p>
            <a href="{% url 'content:list' %}" class="btn btn-outline-success">Browse All</a>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
