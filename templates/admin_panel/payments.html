{% extends 'admin_panel/base.html' %}
{% block title %}Payments — Streamify Admin{% endblock %}
{% block nav_payments %}active{% endblock %}
{% block header_title %}Payments{% endblock %}
{% block content %}
<div class="page-header">
  <div class="page-header-left"><h1>Payments</h1><p>Total revenue: <strong style="color:var(--green)">₹{{ total_revenue|floatformat:2 }}</strong></p></div>
</div>
<div class="panel">
  <div style="padding:16px 20px; border-bottom:1px solid var(--border); display:flex; gap:10px; flex-wrap:wrap;">
    <form method="GET" style="display:flex; gap:10px; flex:1; flex-wrap:wrap; align-items:center;">
      <div class="search-bar" style="flex:1; min-width:180px;"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" name="q" value="{{ q }}" placeholder="Search user..."></div>
      <select name="status" class="filter-select" onchange="this.form.submit()">
        <option value="">All Status</option>
        <option value="completed" {% if status_filter == 'completed' %}selected{% endif %}>Completed</option>
        <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>Pending</option>
        <option value="failed" {% if status_filter == 'failed' %}selected{% endif %}>Failed</option>
        <option value="refunded" {% if status_filter == 'refunded' %}selected{% endif %}>Refunded</option>
      </select>
      <button type="submit" class="btn btn-ghost btn-sm">Search</button>
      {% if q or status_filter %}<a href="{% url 'admin_panel:payments' %}" class="btn btn-ghost btn-sm">Clear</a>{% endif %}
    </form>
  </div>
  <table class="data-table">
    <thead><tr><th>#</th><th>User</th><th>Plan</th><th>Amount</th><th>Status</th><th>Method</th><th>Date</th></tr></thead>
    <tbody>
      {% for p in payments %}
      <tr>
        <td style="font-size:11px; color:var(--muted)">#{{ p.pk }}</td>
        <td>
          <div class="user-cell">
            <div class="avatar" style="width:26px; height:26px; font-size:11px;">{{ p.user.name|first|upper }}</div>
            <div class="user-info"><div class="name">{{ p.user.name|truncatechars:18 }}</div><div class="email">{{ p.user.email|truncatechars:22 }}</div></div>
          </div>
        </td>
        <td style="font-size:12px; color:var(--muted-2)">{{ p.subscription.plan.name|default:"—"|truncatechars:18 }}</td>
        <td style="font-weight:600; color:var(--green)">₹{{ p.amount }}</td>
        <td><span class="badge badge-{% if p.status == 'completed' %}green{% elif p.status == 'failed' %}red{% elif p.status == 'refunded' %}amber{% else %}muted{% endif %}">{{ p.status }}</span></td>
        <td style="font-size:12px; color:var(--muted)">{{ p.payment_method }}</td>
        <td style="font-size:12px; color:var(--muted)">{{ p.payment_date|date:"M d, Y" }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="7"><div class="empty-state"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg><p>No payments found</p></div></td></tr>
      {% endfor %}
    </tbody>
  </table>
  {% if payments.has_other_pages %}
  <div class="pagination">
    {% if payments.has_previous %}<a href="?page={{ payments.previous_page_number }}" class="page-link">‹</a>{% endif %}
    {% for num in payments.paginator.page_range %}<a href="?page={{ num }}" class="page-link {% if payments.number == num %}active{% endif %}">{{ num }}</a>{% endfor %}
    {% if payments.has_next %}<a href="?page={{ payments.next_page_number }}" class="page-link">›</a>{% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}
