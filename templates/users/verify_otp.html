{% extends 'base/base.html' %}
{% block content %}
<div style="max-width:400px; margin:80px auto; background:white; padding:2rem; border-radius:10px; box-shadow:0 2px 15px rgba(0,0,0,0.1); text-align:center;">
  <h2 style="color:#040101;">Verify OTP</h2>
  <p style="color:#040101; font-size:14px;">Enter the 6-digit code sent to your email. It expires in 5 minutes.</p>

  {% for message in messages %}
    <div style="color:{% if message.tags == 'error' %}red{% else %}green{% endif %}; font-size:13px; margin-bottom:10px;">
      {{ message }}
    </div>
  {% endfor %}

  <form method="POST" id="otpForm">
    {% csrf_token %}
    <input type="hidden" name="otp" id="otpValue">
    <div style="display:flex; gap:10px; justify-content:center; margin-bottom:1.5rem;">
      <input type="text" maxlength="1" class="otp-box" autofocus style="width:45px;height:50px;text-align:center;font-size:20px;border:2px solid #ddd;border-radius:8px;outline:none;">
      <input type="text" maxlength="1" class="otp-box" style="width:45px;height:50px;text-align:center;font-size:20px;border:2px solid #ddd;border-radius:8px;outline:none;">
      <input type="text" maxlength="1" class="otp-box" style="width:45px;height:50px;text-align:center;font-size:20px;border:2px solid #ddd;border-radius:8px;outline:none;">
      <input type="text" maxlength="1" class="otp-box" style="width:45px;height:50px;text-align:center;font-size:20px;border:2px solid #ddd;border-radius:8px;outline:none;">
      <input type="text" maxlength="1" class="otp-box" style="width:45px;height:50px;text-align:center;font-size:20px;border:2px solid #ddd;border-radius:8px;outline:none;">
      <input type="text" maxlength="1" class="otp-box" style="width:45px;height:50px;text-align:center;font-size:20px;border:2px solid #ddd;border-radius:8px;outline:none;">
    </div>
    <button type="submit" style="width:100%;padding:11px;background:#4f46e5;color:white;border:none;border-radius:6px;cursor:pointer;font-size:15px;">Verify OTP</button>
  </form>

  <div style="margin-top:1rem; font-size:13px; color:#666;">
    <span id="timerText">Resend code in <strong id="timer">60</strong>s</span>
    <a href="{% url 'users:resend_otp' %}" id="resendLink" style="display:none; color:#4f46e5;">Resend OTP</a>
  </div>
</div>

<script>
  const boxes = document.querySelectorAll('.otp-box');
  boxes.forEach((box, i) => {
    box.addEventListener('input', () => { if (box.value && i < boxes.length - 1) boxes[i+1].focus(); });
    box.addEventListener('keydown', (e) => { if (e.key === 'Backspace' && !box.value && i > 0) boxes[i-1].focus(); });
  });

  document.getElementById('otpForm').addEventListener('submit', () => {
    document.getElementById('otpValue').value = Array.from(boxes).map(b => b.value).join('');
  });

  let seconds = 60;
  const countdown = setInterval(() => {
    seconds--;
    document.getElementById('timer').textContent = seconds;
    if (seconds <= 0) {
      clearInterval(countdown);
      document.getElementById('timerText').style.display = 'none';
      document.getElementById('resendLink').style.display = 'inline';
    }
  }, 1000);
</script>
{% endblock %}