{% extends 'base/base.html' %}

{% block title %}Premium Plans - Streamify{% endblock %}

{% block content %}
<div class="mt-4 text-center mb-5">
    <h2 class="fw-bold">Choose Your Plan</h2>
    <p class="text-muted lead">Unlock unlimited music, videos, and exclusive content</p>
</div>

{% if current_subscription %}
<div class="alert alert-success d-flex align-items-center mb-4">
    <i class="bi bi-check-circle-fill fs-4 me-3"></i>
    <div>
        <strong>You have an active {{ current_subscription.plan.name }} subscription</strong> â€” 
        valid until {{ current_subscription.end_date|date:"F d, Y" }}.
        <a href="{% url 'subscriptions:my_subscription' %}" class="alert-link ms-2">Manage â†’</a>
    </div>
</div>
{% endif %}

<div class="row g-4 justify-content-center mb-5">
    <!-- Free Plan -->
    <div class="col-md-4">
        <div class="card bg-dark border-secondary h-100">
            <div class="card-body p-4 text-center">
                <h4 class="fw-bold">Free</h4>
                <div class="display-4 fw-bold my-3">â‚¹0<small class="fs-5 text-muted">/mo</small></div>
                <ul class="list-unstyled text-start mb-4">
                    <li class="mb-2"><i class="bi bi-check text-success me-2"></i>Access to free content</li>
                    <li class="mb-2"><i class="bi bi-check text-success me-2"></i>Create playlists</li>
                    <li class="mb-2"><i class="bi bi-x text-danger me-2"></i>No premium content</li>
                    <li class="mb-2"><i class="bi bi-x text-danger me-2"></i>Ad-supported</li>
                    <li class="mb-2"><i class="bi bi-x text-danger me-2"></i>No offline downloads</li>
                </ul>
                {% if user.is_authenticated %}
                <a href="{% url 'content:list' %}" class="btn btn-outline-secondary w-100">Continue Free</a>
                {% else %}
                <a href="{% url 'users:register' %}" class="btn btn-outline-secondary w-100">Sign Up Free</a>
                {% endif %}
            </div>
        </div>
    </div>

    {% for plan in plans %}
    <div class="col-md-4">
        <div class="card h-100 {% if forloop.first %}border-success{% else %}border-warning{% endif %}" 
             style="background: linear-gradient(180deg, {% if forloop.first %}#0a1f0a{% else %}#1a1400{% endif %} 0%, #111 100%)">
            {% if forloop.first %}
            <div class="card-header bg-success text-center border-0 py-2">
                <strong>ðŸŽµ Most Popular</strong>
            </div>
            {% endif %}
            <div class="card-body p-4 text-center">
                <h4 class="fw-bold">{{ plan.name }}</h4>
                <div class="display-4 fw-bold my-3">
                    â‚¹{{ plan.price }}<small class="fs-5 text-muted">/{{ plan.duration_days }} days</small>
                </div>
                <p class="text-muted">{{ plan.description }}</p>
                {% if plan.features %}
                <ul class="list-unstyled text-start mb-4">
                    {% for feature in plan.features %}
                    <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>{{ feature }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                {% if user.is_authenticated %}
                    {% if not current_subscription %}
                    <a href="{% url 'payments:checkout' plan.slug %}" 
                       class="btn btn-{% if forloop.first %}success{% else %}warning{% endif %} w-100 btn-lg">
                        <i class="bi bi-star"></i> Subscribe Now
                    </a>
                    {% else %}
                    <button class="btn btn-secondary w-100" disabled>Current Plan</button>
                    {% endif %}
                {% else %}
                <a href="{% url 'users:register' %}" class="btn btn-success w-100 btn-lg">Get Started</a>
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-md-4">
        <div class="card bg-dark border-success h-100">
            <div class="card-header bg-success text-center border-0 py-2"><strong>ðŸŽµ Premium</strong></div>
            <div class="card-body p-4 text-center">
                <h4 class="fw-bold">Premium</h4>
                <div class="display-4 fw-bold my-3">â‚¹999.99<small class="fs-5 text-muted">/mo</small></div>
                <ul class="list-unstyled text-start mb-4">
                    <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>Unlimited streaming</li>
                    <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>All premium content</li>
                    <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>No ads</li>
                    <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>HD quality</li>
                    <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>Offline downloads</li>
                </ul>
                <p class="text-muted small">No plans configured yet. Please add plans in admin.</p>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
